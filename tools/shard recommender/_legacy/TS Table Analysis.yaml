worksheet:
  name: TS Table Analysis
  tables:
  - name: TS_Table_Analysis
  table_paths:
  - id: TS_Table_Analysis_1
    table: TS_Table_Analysis
    join_path:
    - {}
  formulas:
  - name: Ideal Rows per Shard
    expr: if ([TS_Table_Analysis_1::Total Row Count] = 0) then 0 else round(safe_divide([TS_Table_Analysis_1::Total Row Count] , [Ideal Total Shards] ))
  - name: Is Environment Undersized (Gating Measure)
    expr: 'if ([Is Environment Undersized] = "yes" ) then 1 else 0 '
  - name: Is Environment Undersized
    expr: 'if ([Recommended Total Shards] = [Ideal Total Shards] ) then "no" else "yes" '
  - name: Re-Sharding Required (Gating Measure)
    expr: if([Re-Sharding Required] = "yes" ) then 1 else 0
  - name: Re-Sharding Required
    expr: 'if ([TS_Table_Analysis_1::Total Shards] = [Recommended Total Shards] )then "no" else "yes" '
  - name: Recommended Rows per Shard
    expr: 'if([TS_Table_Analysis_1::Total Row Count] = 0) then 0 else (round(safe_divide([TS_Table_Analysis_1::Total Row Count] , [Recommended Total Shards]) )) '
  - name: Recommended Total Shards
    expr: 'if ([Ideal Total Shards] > [CPU Available]) then [CPU Available] else [Ideal Total Shards] '
  - name: CPU Available
    expr: round (([Total TS Nodes (Constant Parameter)] * [CPU Per Node (Constant Parameter)]) * 0.6 )
  - name: CPU Per Node (Constant Parameter)
    expr: '56 '
  - name: Ideal Total Shards
    expr: 'if ([TS_Table_Analysis_1::Total Shards] = 0 ) then 0 else if ([TS_Table_Analysis_1::Total Row Count] <=[Maximum Rows per Shard with Single Shard (Constant Parameter)] and [TS_Table_Analysis_1::Total Shards] = 1 ) then 1 else if ([TS_Table_Analysis_1::Total Shards] = 1 and [Current Rows per Shard] > [Maximum Rows per Shard with Single Shard (Constant Parameter)]) then round (safe_divide ([TS_Table_Analysis_1::Total Row Count] , [Ideal Rows Per Shard (Constant Parameter)] )) else if ([TS_Table_Analysis_1::Total Shards] > 1 and [Current Rows per Shard] > [Maximum Rows Per Shard (Constant Parameter)]) then round (safe_divide([TS_Table_Analysis_1::Total Row Count] , [Ideal Rows Per Shard (Constant Parameter)])) else if ([TS_Table_Analysis_1::Total Shards] > 1 and [Current Rows per Shard] < [Minimum Rows Per Shard (Constant Parameter)]) then round (safe_divide ([TS_Table_Analysis_1::Total Row Count] , [Ideal Rows Per Shard (Constant Parameter)])) else [TS_Table_Analysis_1::Total Shards] '
  - name: Ideal Rows Per Shard (Constant Parameter)
    expr: '20000000 '
  - name: Table Currently Under Or Over Sharded?
    expr: 'if([TS_Table_Analysis_1::Total Shards] > 1 and [Current Rows per Shard] > [Maximum Rows Per Shard (Constant Parameter)] ) then ''under sharded'' else if([TS_Table_Analysis_1::Total Shards] > 1 and [Current Rows per Shard] < [Minimum Rows Per Shard (Constant Parameter)] ) then ''over sharded'' else if ([TS_Table_Analysis_1::Total Shards] = 1 and [Current Rows per Shard] > [Maximum Rows per Shard with Single Shard (Constant Parameter)] ) then ''under sharded'' else ''not applicable'' '
  - name: Current Rows per Shard
    expr: 'if ([TS_Table_Analysis_1::Total Row Count] = 0) then 0 else (round(safe_divide ([TS_Table_Analysis_1::Total Row Count] , [TS_Table_Analysis_1::Total Shards])) ) '
  - name: Maximum Rows Per Shard (Constant Parameter)
    expr: '20000000 '
  - name: Maximum Rows per Shard with Single Shard (Constant Parameter)
    expr: '30000000 '
  - name: Minimum Rows Per Shard (Constant Parameter)
    expr: "15000000"
  - name: Total TS Nodes (Constant Parameter)
    expr: '24 '
  worksheet_columns:
  - name: Database Name
    column_id: TS_Table_Analysis_1::Database Name
    properties:
      column_type: ATTRIBUTE
  - name: Schema Name
    column_id: TS_Table_Analysis_1::Schema Name
    properties:
      column_type: ATTRIBUTE
  - name: Table Name
    column_id: TS_Table_Analysis_1::Table Name
    properties:
      column_type: ATTRIBUTE
  - name: Table Guid
    column_id: TS_Table_Analysis_1::Table Guid
    properties:
      column_type: ATTRIBUTE
      index_type: DONT_INDEX
  - name: Status
    column_id: TS_Table_Analysis_1::Status
    properties:
      column_type: ATTRIBUTE
  - name: Serving Timestamp
    column_id: TS_Table_Analysis_1::Serving Timestamp
    properties:
      column_type: ATTRIBUTE
  - name: Current Total Row Count
    column_id: TS_Table_Analysis_1::Total Row Count
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Current Row Count Skew
    column_id: TS_Table_Analysis_1::Row Count Skew
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Current Uncompressed Size (MB)
    column_id: TS_Table_Analysis_1::Uncompressed Size (MB)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Current Estimated Size (MB)
    column_id: TS_Table_Analysis_1::Estimated Size (MB)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Current Estimated Size (MB) Skew
    column_id: TS_Table_Analysis_1::Estimated Size (MB) Skew
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Current Total Shards
    column_id: TS_Table_Analysis_1::Total Shards
    properties:
      column_type: MEASURE
      aggregation: SUM
      format_pattern: '#.############'
  - name: Current Cluster Space Used (MB)
    column_id: TS_Table_Analysis_1::Cluster Space Used (MB)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Last Updated Timestamp
    column_id: TS_Table_Analysis_1::Last Updated Timestamp
    properties:
      column_type: ATTRIBUTE
  - name: Deleted Rows
    column_id: TS_Table_Analysis_1::Deleted Rows
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Current Rows per Shard
    formula_id: Current Rows per Shard
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Total TS Nodes (Constant Parameter)
    formula_id: Total TS Nodes (Constant Parameter)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: CPU Per Node (Constant Parameter)
    formula_id: CPU Per Node (Constant Parameter)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: CPU Available
    formula_id: CPU Available
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Minimum Rows Per Shard (Constant Parameter)
    formula_id: Minimum Rows Per Shard (Constant Parameter)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Maximum Rows Per Shard (Constant Parameter)
    formula_id: Maximum Rows Per Shard (Constant Parameter)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Recommended Total Shards
    formula_id: Recommended Total Shards
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Ideal Rows Per Shard (Constant Parameter)
    formula_id: Ideal Rows Per Shard (Constant Parameter)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Re-Sharding Required
    formula_id: Re-Sharding Required
    properties:
      column_type: ATTRIBUTE
  - name: Ideal Rows per Shard
    formula_id: Ideal Rows per Shard
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Recommended Rows per Shard
    formula_id: Recommended Rows per Shard
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Ideal Total Shards
    formula_id: Ideal Total Shards
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Re-Sharding Required (Gating Measure)
    formula_id: Re-Sharding Required (Gating Measure)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Is Environment Undersized
    formula_id: Is Environment Undersized
    properties:
      column_type: ATTRIBUTE
  - name: Is Environment Undersized (Gating Measure)
    formula_id: Is Environment Undersized (Gating Measure)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Maximum Rows per Shard with Single Shard (Constant Parameter)
    formula_id: Maximum Rows per Shard with Single Shard (Constant Parameter)
    properties:
      column_type: MEASURE
      aggregation: SUM
  - name: Table Currently Under Or Over Sharded?
    formula_id: Table Currently Under Or Over Sharded?
    properties:
      column_type: ATTRIBUTE
  properties:
    is_bypass_rls: false
    join_progressive: true
